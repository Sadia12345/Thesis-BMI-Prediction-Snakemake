---
title: "ML Results"
date: "`r Sys.Date()`"
output:
  html_document:
    keep_md: true
    self_contained: true
    theme: spacelab
params:
  dataset: "metalog_test"
  ml_methods: !r c("glmnet", "rf")
  nseeds: 10
  ncores: 1
  kfold: 2
  config_path: "config/config.yaml"
  find_feature_importance: TRUE
---

```{r setup, include=FALSE}
schtools::set_knitr_opts()
library(knitr)
# FORCE absolute paths - Hardcoded
figures_dir <- "D:/Thesis_Project/mikropml-snakemake-workflow/figures"
figures_dir <- file.path(figures_dir, params$dataset)

# Helper to get absolute path
get_fig_path <- function(filename) {
  file.path(figures_dir, filename)
}
```

# Model Performance

```{r results, echo=FALSE, message=FALSE, warning=FALSE, out.width="100%"}
# include_graphics(get_fig_path("rulegraph.png"))

cat("### Model Performance metrics\n")
cat("This figure summarizes the Area Under the Receiver Operating Characteristic (AUROC) curve for each machine learning method. Higher values indicate better predictive performance.\n\n")
include_graphics(get_fig_path("performance.png"))

# cat("\n### ROC Curves\n")
# cat("The Receiver Operating Characteristic (ROC) curves illustrate the trade-off between sensitivity (true positive rate) and specificity (1 - false positive rate) across different threshold settings.\n\n")
# include_graphics(get_fig_path("roc_curves.png"))

cat("\n### Hyperparameter Tuning\n")
cat("These plots show the model performance across different hyperparameter values during the cross-validation phase, identifying the optimal configuration for training.\n\n")
hp_paths <- file.path(figures_dir, paste0("hp_performance_", params$ml_methods, ".png"))
include_graphics(hp_paths)

if (isTRUE(params$find_feature_importance)) {
  cat("\n### Feature Importance\n")
  cat("Top predictive features identified by the model. Importance is measured by the decrease in performance when the feature's values are randomly permuted.\n\n")
}
include_graphics(get_fig_path("feature_importance.png"))
include_graphics(get_fig_path("benchmarks.png"))
```